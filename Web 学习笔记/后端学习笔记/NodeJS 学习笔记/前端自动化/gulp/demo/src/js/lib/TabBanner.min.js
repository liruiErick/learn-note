!function(t,i){"use strict";"function"==typeof define&&define.amd?define(["jquery","DragEvent"],i):"object"==typeof exports?module.exports=i(require("jquery"),require("DragEvent")):(t.bjj=t.bjj||{},t.bjj.TabBanner=i(t.jQuery,t.bjj.DragEvent))}(this,function(t,i){"use strict";function s(){this._init.apply(this,arguments)}function e(i,s,e){var n=t();t.each(i,function(i,s){for(var e,h=s instanceof jQuery?s:t(s),r=h.parents().andSelf().filter(":hidden"),i=r.length;i--&&h.is(":hidden");)e=r.eq(i),"none"===e.css("display")&&(n=n.add(e.show()))}),"function"==typeof s&&s.call(e||this),n.hide()}var n=!1,h=navigator.appVersion.match(/MSIE (\d+\.\d)/),r=h&&h[1]-0;"Microsoft Internet Explorer"===navigator.appName&&8>=r&&(n=!0);var a=!!navigator.userAgent.match(/mobile/i),o=t(window),c={neglectSelector:".ie7_anon",itemActiveClass:"active",prevBtn:null,nextBtn:null,btnDisableClass:"disabled",defaultTabBtn:{size:10,color:"#666",activeColor:"#ccc",style:{},wrapStyle:{}},tabBtnWrap:null,tabBtnActiveClass:"active",tabBtnActiveEvent:"mouseenter",hideTabBtn:!1,initIndex:0,interval:5e3,duration:400,mouseStopTab:!1,loop:!0,effect:"slide",isVer:!1,onResize:function(){},onEnter:function(){},onLeave:function(){},onTab:function(){},onClick:function(){}},l=s.prototype;return l._init=function(i,s){var e=t.extend(!0,{},c,s);this.$container=t(i).css({overflow:"hidden","user-select":"none"}),"static"===this.$container.css("position")&&this.$container.css("position","relative"),this.$wrap=this.$container.children().first().css({position:"absolute",left:0,right:0,top:0,bottom:0}),this.neglectSelector=e.neglectSelector,this.itemActiveClass=e.itemActiveClass,this.$prevBtn=t(e.prevBtn),this.$nextBtn=t(e.nextBtn),this.hasPrevBtn=!!this.$prevBtn.length,this.hasNextBtn=!!this.$nextBtn.length,this.btnDisableClass=e.btnDisableClass,this.interval=e.interval,this.duration=e.duration,this.noTimer=this.interval<=0,this.mouseStopTab=e.mouseStopTab,this.loop=e.loop,this.effect=e.effect,this.isVer=e.isVer,this.onResize=e.onResize,this.onEnter=e.onEnter,this.onLeave=e.onLeave,this.onTab=e.onTab,this.onClick=e.onClick,this.$tabBtnWrap=t(e.tabBtnWrap),this.hideTabBtn=e.hideTabBtn,this.isCustomBtn=!!this.$tabBtnWrap.length,this.tabBtnActiveEvent=e.tabBtnActiveEvent,this.isCustomBtn?this.tabBtnActiveClass=e.tabBtnActiveClass:this.defaultTabBtn=e.defaultTabBtn,this.hasPrevBtn&&this.$prevBtn.css({"user-select":"none",cursor:"pointer"}),this.hasNextBtn&&this.$nextBtn.css({"user-select":"none",cursor:"pointer"}),"slide"===this.effect&&(t.cssHooks.x?(this.useTransform=!0,this.tabAttr=this.isVer?"y":"x",t.support.transform3d&&this.$wrap.css("z",0)):this.tabAttr=this.isVer?"top":"left",this.sizeApi=this.isVer?"height":"width"),this.prevTab=t.proxy(this,"prevTab"),this.nextTab=t.proxy(this,"nextTab"),this._btnTabItem=t.proxy(this,"_btnTabItem"),this._resize=t.proxy(this,"_resize"),this._onClick=t.proxy(this,"_onClick"),this._onTab=t.proxy(this,"_onTab"),this.update(e.initIndex),this.noTimer||(this._setTimer=t.proxy(this,"_setTimer"),this._clearTimer=t.proxy(this,"_clearTimer"),this._setTimer(),a?(this._addHover=function(t){t.on("touchstart",this._clearTimer),t.on("touchend",this._setTimer)},this._removeHover=function(t){t.off("touchstart",this._clearTimer),t.off("touchend",this._setTimer)}):(this._addHover=function(t){t.on("mouseenter",this._clearTimer),t.on("mouseleave",this._setTimer)},this._removeHover=function(t){t.off("mouseenter",this._clearTimer),t.off("mouseleave",this._setTimer)})),this._addEvent()},l._addEvent=function(){a?(o.on("resize",this._resize),this.$tabBtn.on("touchend",this._btnTabItem),this.hasPrevBtn&&this.$prevBtn.on("touchend",this.prevTab),this.hasNextBtn&&this.$nextBtn.on("touchend",this.nextTab),"slide"===this.effect&&(this.startPos=0,this.curPos=0,this.horizontal=!1,this.vertical=!1,this.startX=0,this.startY=0,this.r=.5,this.dragEvent=new i({obj:this.$wrap,holder:this,start:this._touchstartHandler,move:this._touchmoveHandler,end:this._touchendHandler}))):(o.on("resize",this.onResize),this.$tabBtn.on(this.tabBtnActiveEvent,this._btnTabItem),this.hasPrevBtn&&this.$prevBtn.on("click",this.prevTab),this.hasNextBtn&&this.$nextBtn.on("click",this.nextTab)),this.$wrap.on("click",">",this._onClick),this.noTimer||(this._addHover(this.$tabBtn),this.mouseStopTab&&this._addHover(this.$container),this.hasPrevBtn&&this._addHover(this.$prevBtn),this.hasNextBtn&&this._addHover(this.$nextBtn))},l._removeEvent=function(){a?(o.off("resize",this._resize),this.$tabBtn.off("touchend",this._btnTabItem),this.hasPrevBtn&&this.$prevBtn.off("touchend",this.prevTab),this.hasNextBtn&&this.$nextBtn.off("touchend",this.nextTab),this.dragEvent&&this.dragEvent.remove()):(o.off("resize",this.onResize),this.$tabBtn.off(this.tabBtnActiveEvent,this._btnTabItem),this.hasPrevBtn&&this.$prevBtn.off("click",this.prevTab),this.hasNextBtn&&this.$nextBtn.off("click",this.nextTab)),this.$wrap.off("click",">",this._onClick),this.noTimer||(this._removeHover(this.$tabBtn),this.mouseStopTab&&this._removeHover(this.$container),this.hasPrevBtn&&this._removeHover(this.$prevBtn),this.hasNextBtn&&this._removeHover(this.$nextBtn))},l._setTimer=function(){this.timerId=setInterval(this.nextTab,this.interval)},l._clearTimer=function(){clearInterval(this.timerId)},l._onClick=function(t){this.onClick.call(t.currentTarget,this.curIndex)},l._touchstartHandler=function(t,i){this.startX=i.x,this.startY=i.y},l._touchmoveHandler=function(t,i){var s=i.x-this.startX,e=i.y-this.startY;if(!this.horizontal&&!this.vertical){var n=Math.abs(s),h=Math.abs(e);this.isVer?h>=n?(this.vertical=!0,this.noTimer||this._clearTimer(),this.$wrap.stop(),this.startPos=parseInt(this.$wrap.css(this.tabAttr))):(this.horizontal=!0,this.startX=i.x,this.startY=i.y):n>=h?(this.horizontal=!0,this.noTimer||this._clearTimer(),this.$wrap.stop(),this.startPos=parseInt(this.$wrap.css(this.tabAttr))):(this.vertical=!0,this.startX=i.x,this.startY=i.y)}if((this.isVer||this.horizontal)&&(!this.isVer||this.vertical)){if(t.preventDefault(),this.curPos=this._outOfRange(this.isVer?this.startPos+e:this.startPos+s),this.loop){for(;this.curPos>this.minOffset;)this._prevRepair(),this.startPos-=this.distance,this.curPos=this.startPos+s;for(;this.curPos<this.maxOffset;)this._nextRepair(),this.startPos+=this.distance,this.curPos=this.startPos+s}this._gotoPos(this.curPos)}},l._touchendHandler=function(t,i){if(this.vertical||this.horizontal||this.onClick(this.curIndex),this.isVer){if(this.horizontal=!1,!this.vertical)return;this.vertical=!1}else{if(this.vertical=!1,!this.horizontal)return;this.horizontal=!1}var s,e=this.curPos/-this.distance;return this.isVer?(s=i.stepDy<0?Math.ceil(e-this.r):Math.floor(e+this.r),i.swipeTop&&e>s?s++:i.swipeBottom&&s>e&&s--):(s=i.stepDx<0?Math.ceil(e-this.r):Math.floor(e+this.r),i.swipeLeft&&e>s?s++:i.swipeRight>0&&s>e&&s--),this.loop&&(this.curIndex=this._getCurIndex(s)),this.realIndex=this._limitIndex(s),this.loop||(this.curIndex=this.realIndex),this._tabBtn(),this._tab(),this.noTimer||this._setTimer(),!1},l._resize=function(){t.contains(document,this.$container[0])&&("slide"===this.effect&&(a?e(this.$container,function(){this.distance=this.$container[this.sizeApi](),this.maxOffset=-this.distance*this.maxIndex},this):this.distance=this.useTransform?100/this.itemCount:100),this._tabBtn(),this._tab(0),this.onResize&&this.onResize())},l._btnTabItem=function(t){var i=this.$tabBtn.index(t.currentTarget);if(i!=this.curIndex){if("slide"===this.effect){var s,e=this._getRealIndex(i);if(i>this.curIndex&&e<this.realIndex){for(s=e+1;s--;)this._nextRepair();this.realIndex=this.maxIndex}else if(i<this.curIndex&&e>this.realIndex){for(s=this.itemCount-e;s--;)this._prevRepair();this.realIndex=0}else this.realIndex=e}this.curIndex=i,this._tabBtn(),this._tab()}},l._getRealIndex=function(t){var i=t-this.curIndex+this.realIndex;return(i%this.itemCount+this.itemCount)%this.itemCount},l._getCurIndex=function(t){var i=t-this.realIndex+this.curIndex;return(i%this.itemCount+this.itemCount)%this.itemCount},l._prevRepair=function(){var t=this.$wrap.children(":not("+this.neglectSelector+")");t.last().insertBefore(t.first()),this.realIndex++;var i="-="+this.distance;a||(i+="%"),this._gotoPos(i)},l._nextRepair=function(){var t=this.$wrap.children(":not("+this.neglectSelector+")");t.first().insertAfter(t.last()),this.realIndex--;var i="+="+this.distance;a||(i+="%"),this._gotoPos(i)},l._tabBtn=function(){this.isCustomBtn?(this.$tabBtn.removeClass(this.tabBtnActiveClass),this.$tabBtn.eq(this.curIndex).addClass(this.tabBtnActiveClass)):(this.$tabBtn.css("background",this.btnDefaultColor),this.$tabBtn.eq(this.curIndex).css("background",this.btnActiveColor))},l._gotoPos=function(t){var i={};i[this.tabAttr]=t,this.$wrap.stop().animate(i,0)},l._tab=function(t){if("number"!=typeof t&&(t=this.duration),this.$prevItem=this.$curItem.removeClass(this.itemActiveClass),this.prevIndex=this.$item.index(this.$prevItem),this.$curItem=this.$item.eq(this.curIndex).addClass(this.itemActiveClass),this.onEnter.call(this.$curItem[0],this.curIndex,this.$curItem),"slide"===this.effect){var i={};i[this.tabAttr]=-this.distance*this.realIndex,a||(i[this.tabAttr]+="%"),this.$wrap.stop().animate(i,t,this._onTab)}else"fade"===this.effect&&(this.prevIndex>=0&&this.$prevItem.fadeOut(t),this.$curItem.fadeIn(t,this._onTab))},l._onTab=function(){this.loop||(this.hasPrevBtn&&(0==this.curIndex?this.$prevBtn.addClass(this.btnDisableClass):this.$prevBtn.removeClass(this.btnDisableClass)),this.hasNextBtn&&(this.curIndex==this.maxIndex?this.$nextBtn.addClass(this.btnDisableClass):this.$nextBtn.removeClass(this.btnDisableClass))),this.prevIndex>=0&&this.onLeave.call(this.$prevItem[0],this.prevIndex,this.$prevItem),this.onTab.call(this.$curItem[0],this.curIndex,this.$curItem)},l._limitIndex=function(t){return Math.max(0,Math.min(this.maxIndex,t))},l._outOfRange=function(t){return t>this.minOffset&&(t*=.3),t<this.maxOffset&&(t=.3*(t-this.maxOffset)+this.maxOffset),t},l._createTabBtn=function(){var i=this.$tabBtnWrap.children().removeClass(this.tabBtnActiveClass),s=i.length,e=this.itemCount-s;if(i=i.eq(0),this.isCustomBtn)for(;e-->0;)this.$tabBtnWrap.append(s?i.clone():"<div>");else{this.btnDefaultColor=this.defaultTabBtn.color,this.btnActiveColor=this.defaultTabBtn.activeColor;var n,h,r,a=this.defaultTabBtn.size,o=this.defaultTabBtn.wrapStyle,c=this.defaultTabBtn.style,l=2*a*this.itemCount;this.isVer?(n="width",h="top",r="right"):(n="height",h="left",r="bottom");var d={};for(d.position="absolute",d[n]=2*a,d[r]=a,d[h]="50%",d["margin-"+h]=-l/2,d[this.sizeApi]=l,this.$tabBtnWrap=t("<div>"),this.$tabBtnWrap.css(d).css(o);e--;)t("<div>").css({"float":"left",width:a,height:a,margin:a/2+"px",background:this.btnDefaultColor,"border-radius":"50%","-webkit-box-shadow":"1px 1px 1px rgba(0,0,0,0.3)","box-shadow":"1px 1px 1px rgba(0,0,0,0.3)"}).css(c).appendTo(this.$tabBtnWrap);this.$wrap.after(this.$tabBtnWrap)}this.$tabBtn=this.$tabBtnWrap.children().css("cursor","pointer"),this.hideTabBtn&&this.$tabBtnWrap.hide()},l.update=function(i){this.$item=this.$wrap.children(":not("+this.neglectSelector+")"),this.$curItem=t(),this.itemCount=this.$item.length,1===this.itemCount&&(this.loop=!1),"slide"===this.effect?(this.$item.css({width:"100%",height:"100%"}),this.isVer||this.$item.css("float","left"),this.$wrap[this.sizeApi](100*this.itemCount+"%"),this.$item[this.sizeApi](100/this.itemCount+"%")):"fade"===this.effect&&(this.$wrap.css({width:"100%",height:"100%"}),this.$item.css({position:"absolute",left:0,top:0,width:"100%",height:"100%"}).hide()),this.minOffset=0,this.maxIndex=this.itemCount-1,this.prevIndex=-1,this.curIndex="number"==typeof i&&i>0&&i<this.itemCount?i:0,this.realIndex=this.curIndex,this._createTabBtn(),n?window.setTimeout(this._resize,0):this._resize()},l.nextTab=function(t){if(this.curIndex++,this.realIndex++,this.loop)this.curIndex>this.maxIndex&&(this.curIndex=0),"slide"===this.effect&&this.realIndex>this.maxIndex&&this._nextRepair();else if(this.curIndex>this.maxIndex&&(this.curIndex=this.realIndex=this.maxIndex,t))return;this._tabBtn(),this._tab()},l.prevTab=function(t){if(this.curIndex--,this.realIndex--,this.loop&&"slide"===this.effect)this.curIndex<0&&(this.curIndex=this.maxIndex),"slide"===this.effect&&this.realIndex<0&&this._prevRepair();else if(this.curIndex<0&&(this.curIndex=this.realIndex=0,t))return;this._tabBtn(),this._tab()},l.gotoItem=function(t){this.realIndex=this._getCurIndex(t),this.curIndex=t,this._tab()},l.destroy=function(){this._removeEvent(),this.$container=null,this.$wrap=null,this.$item=null,this.$prevItem=null,this.$curItem=null,this.$tabBtnWrap=null,this.$tabBtn=null,this.$prevBtn=null,this.$nextBtn=null},s});