!function(t,i){"use strict";"object"==typeof module&&"object"==typeof exports?module.exports=i(require("jquery"),require("DragEvent")):"function"==typeof define&&define.amd?define(["jquery","DragEvent"],i):(t.bjj=t.bjj||{},t.bjj.Slider=i(t.jQuery,t.bjj.DragEvent))}(this,function(t,i){"use strict";function s(){this._init.apply(this,arguments)}var e=!!navigator.userAgent.match(/mobile/i),h=t(window),n={item:">",prevBtn:null,nextBtn:null,btnDisableClass:"disabled",align:"start",isVer:!1,offset:0,activeClass:"active",initIndex:0,duration:400,aequilate:!0,onClick:function(t){},onSlide:function(t,i){}},a=s.prototype;return a._init=function(i,s){var e=t.extend({},n,s);this.$container=t(i).css({overflow:"hidden","user-select":"none"}),this.$wrap=this.$container.children().first().css("cursor","-webkit-grab"),this.item=e.item,this.$prevBtn=t(e.prevBtn),this.$nextBtn=t(e.nextBtn),this.hasPrevBtn=!!this.$prevBtn.length,this.hasNextBtn=!!this.$nextBtn.length,this.btnDisableClass=e.btnDisableClass,this.isVer=e.isVer,this.offset=e.offset,this.activeClass=e.activeClass,this.duration=e.duration,this.aequilate=e.aequilate,this.onClick=e.onClick,this.onSlide=e.onSlide,this.hasPrevBtn&&this.$prevBtn.css("user-select","none"),this.hasNextBtn&&this.$nextBtn.css("user-select","none"),"end"===e.align?this.sizeRatio=1:"center"===e.align?this.sizeRatio=.5:this.sizeRatio=0,t.cssHooks.x?(this.isVer?this.tabAttr="y":this.tabAttr="x",t.support.transform3d&&this.$wrap.css("z",0)):(this.isVer?this.tabAttr="top":this.tabAttr="left","static"===this.$wrap.css("position")&&this.$wrap.css("position","relative")),this.isVer?(this.beforeType="top",this.afterType="bottom",this.sizeApi="height"):(this.beforeType="left",this.afterType="right",this.sizeApi="width"),this.prevPage=t.proxy(this,"prevPage"),this.nextPage=t.proxy(this,"nextPage"),this._resize=t.proxy(this,"_resize"),this._onClick=t.proxy(this,"_onClick"),this.update(e.initIndex),this._addEvent()},a._addEvent=function(){h.on("resize",this._resize),e?(this.hasPrevBtn&&this.$prevBtn.on("touchend",this.prevPage),this.hasNextBtn&&this.$nextBtn.on("touchend",this.nextPage)):(this.hasPrevBtn&&this.$prevBtn.on("click",this.prevPage),this.hasNextBtn&&this.$nextBtn.on("click",this.nextPage)),this.startPos=0,this.curPos=0,this.horizontal=!1,this.vertical=!1,this.startX=0,this.startY=0,this.dx=0,this.dy=0,this.r=.5,this.dragEvent=new i({obj:this.$wrap,holder:this,start:this._touchstartHandler,move:this._touchmoveHandler,end:this._touchendHandler}),this.$wrap.on("click",this.item,this._onClick)},a._removeEvent=function(){h.off("resize",this._resize),e?(this.hasPrevBtn&&this.$prevBtn.off("touchend",this.prevPage),this.hasNextBtn&&this.$nextBtn.off("touchend",this.nextPage)):(this.hasPrevBtn&&this.$prevBtn.off("click",this.prevPage),this.hasNextBtn&&this.$nextBtn.off("click",this.nextPage)),this.dragEvent&&this.dragEvent.remove(),this.$wrap.off("click",this.item,this._onClick)},a._resize=function(){t.contains(document,this.$container[0])&&function(i,s,e){var h=t();t.each(i,function(i,s){for(var e,n=s instanceof jQuery?s:t(s),a=n.parents().addBack().filter(":hidden"),i=a.length;i--&&n.is(":hidden");)"none"===(e=a.eq(i)).css("display")&&(h=h.add(e.show()))}),"function"==typeof s&&s.call(e||this),h.hide()}(this.$wrap,function(){var i=this.$item.first(),s=parseInt(i.css("padding-"+this.beforeType))+parseInt(i.css("margin-"+this.beforeType))+parseInt(i.css("border-"+this.beforeType+"-width")),e=parseInt(i.css("padding-"+this.afterType))+parseInt(i.css("margin-"+this.afterType))+parseInt(i.css("border-"+this.afterType+"-width")),h=s-e,n=this.$item.last(),a=parseInt(n.css("padding-"+this.beforeType))+parseInt(n.css("margin-"+this.beforeType))+parseInt(n.css("border-"+this.beforeType+"-width")),r=0,o=h+(parseInt(n.css("padding-"+this.afterType))+parseInt(n.css("margin-"+this.afterType))+parseInt(n.css("border-"+this.afterType+"-width"))-a);0===o&&(r=h),this.parentSize=this.$container[this.sizeApi](),this.itemSize=[],this.itemPos=[];var c=this,l=0,p=e+a,u=parseInt(this.$wrap.css("padding-"+this.beforeType))+parseInt(this.$wrap.css("padding-"+this.afterType));if(this.aequilate){var d=this.$item[this.sizeApi]()+p;this.$item.each(function(t){c.itemPos.push(-d*t+c.offset),c.itemSize.push(d)}),l=d*this.itemCount+o,this.displayCount=this.parentSize/d|0}else this.$item.each(function(i,s){c.itemPos.push(-l+c.offset);var e=t(s),h=e.css(c.sizeApi,"")[c.sizeApi]();e[c.sizeApi](h),h+=p,c.itemSize.push(h),l+=h}),l+=o;this.minPos=this.offset,this.maxPos=this.parentSize-u-l-r-this.offset,this.maxPos=Math.min(this.maxPos,0),this.$wrap[this.sizeApi](l),this.ailgnOffset=(this.parentSize-(o+r+2*this.offset))*this.sizeRatio,this.minIndex=Math.max(0,Math.floor(this._calculateMultiple(this.minPos)-this.sizeRatio)),this.maxIndex=Math.min(this.itemCount-1,Math.ceil(this._calculateMultiple(this.maxPos)-this.sizeRatio)),this._slide(0)},this)},a._limitIndex=function(t){return Math.min(this.maxIndex,Math.max(this.minIndex,t))},a._fixedRange=function(t){return Math.min(this.minPos,Math.max(this.maxPos,t))},a._outOfRange=function(t){return t>this.minPos&&(t*=.3),t<this.maxPos&&(t=.3*(t-this.maxPos)+this.maxPos),t},a._gotoPos=function(t){var i={};i[this.tabAttr]=t,this.$wrap.css(i)},a._slide=function(t){"number"!=typeof t&&(t=this.duration);var i=this._limitIndex(this.curIndex),s=this.itemPos[i],e={};return e[this.tabAttr]=this._fixedRange(s+this.ailgnOffset-this.itemSize[i]*this.sizeRatio),this.curItemOffset=e[this.tabAttr]-this.itemPos[this.curIndex],this.onSlide.call(this.$item[this.curIndex],this.curIndex,this.curItemOffset),this.minPos>this.maxPos?(this.hasPrevBtn&&(this.curIndex<=this.minIndex?this.$prevBtn.addClass(this.btnDisableClass):this.$prevBtn.removeClass(this.btnDisableClass)),this.hasNextBtn&&(this.curIndex>=this.maxIndex?this.$nextBtn.addClass(this.btnDisableClass):this.$nextBtn.removeClass(this.btnDisableClass))):(this.hasPrevBtn&&this.$prevBtn.addClass(this.btnDisableClass),this.hasNextBtn&&this.$nextBtn.addClass(this.btnDisableClass)),this.$wrap.stop().animate(e,t),this.curItemOffset},a._onClick=function(t){if(this.isClick){var i=this.$item.index(t.currentTarget);this.setItem(i),this.onClick.call(t.currentTarget,i)}},a._touchstartHandler=function(t,i){this.isClick=!0,this.startX=i.x,this.startY=i.y,this.$wrap.css("cursor","-webkit-grabbing")},a._touchmoveHandler=function(t,i){if(this.dx=i.x-this.startX,this.dy=i.y-this.startY,!this.horizontal&&!this.vertical){var s=Math.abs(this.dx),e=Math.abs(this.dy);this.isVer?s<=e?(this.vertical=!0,this.$wrap.stop(),this.startPos=parseInt(this.$wrap.css(this.tabAttr))):(this.horizontal=!0,this.startX=i.x,this.startY=i.y):s>=e?(this.horizontal=!0,this.$wrap.stop(),this.startPos=parseInt(this.$wrap.css(this.tabAttr))):(this.vertical=!0,this.startX=i.x,this.startY=i.y)}!this.isVer&&!this.horizontal||this.isVer&&!this.vertical||(t.preventDefault(),this.isClick=!1,this.isVer?this.curPos=this._outOfRange(this.startPos+this.dy):this.curPos=this._outOfRange(this.startPos+this.dx),this._gotoPos(this.curPos))},a._touchendHandler=function(t,i){if(this.$wrap.css("cursor","-webkit-grab"),this.isVer){if(this.horizontal=!1,!this.vertical)return;this.vertical=!1}else{if(this.vertical=!1,!this.horizontal)return;this.horizontal=!1}if(this.isVer&&(i.swipeTop||i.swipeBottom))i.swipeTop?this.nextPage():i.swipeBottom&&this.prevPage();else if(this.isVer||!i.swipeLeft&&!i.swipeRight){var s=this._calculateMultiple(this.curPos)-this.sizeRatio;this.isVer?this.curIndex=this.dy<0?Math.ceil(s-this.r):Math.floor(s+this.r):this.curIndex=this.dx<0?Math.ceil(s-this.r):Math.floor(s+this.r),this._slide()}else i.swipeLeft?this.nextPage():i.swipeRight&&this.prevPage();return!1},a._calculateMultiple=function(t){var i=0,s=t-this.ailgnOffset-this.offset;if(this.aequilate)s<0&&(i=Math.max(0,-s)/this.itemSize[0]);else for(var e,h,n=0,a=this.itemCount;n<a;n++)if(e=this.itemPos[n],h=this.itemSize[n],e-h<s){i=Math.max(0,e-s)/h+n;break}return i},a.prevPage=function(){var t=this.curIndex;if(this.aequilate)t-=this.displayCount;else for(var i=this.itemPos[t],s=t;s>=0&&!(this.itemPos[s]-i>=this.parentSize);s--)t=s;t=Math.max(this.minIndex,t),this.curIndex=t,this._slide()},a.nextPage=function(){var t=this.curIndex;if(this.aequilate)t+=this.displayCount;else for(var i,s=this.itemPos[t],e=t,h=this.itemCount;e<h&&(i=this.itemPos[e],!(s-i>=this.parentSize));e++)t=e;t=Math.min(this.maxIndex,t),this.curIndex=t,this._slide()},a.update=function(t){this.$item=this.$wrap.find(this.item),this.itemCount=this.$item.length,this.curIndex="number"==typeof t&&t>=0&&t<this.itemCount?t:1===this.sizeRatio?itemCount-1:0,this.setItem(t),window.setTimeout(this._resize)},a.setItem=function(t){this.curActiveIndex=t,this.$item.removeClass(this.activeClass),t<0||t>=this.itemCount||this.$item.eq(t).addClass(this.activeClass)},a.gotoItem=function(t){return this.curIndex=t,this._slide()},a.destroy=function(){this._removeEvent(),this.$container=null,this.$wrap=null,this.$item=null,this.$prevBtn=null,this.$nextBtn=null},s});