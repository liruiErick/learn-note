!function(t,e){"use strict";"object"==typeof module&&"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):(t.bjj=t.bjj||{},t.bjj.DragEvent=e())}(this,function(){"use strict";function t(i){if(!(this instanceof t))return new t(i);this._options=e({},p,i),this._init()}function e(){var t,i,s,n,o,a=arguments[0]||{},r=typeof a,c=Object.prototype.toString,l=1,h=arguments.length,d=!1;for("boolean"===r&&(d=a,r=typeof(a=arguments[l]||{}),l++),"object"!==r&&"function"!==r&&(a={}),l===h&&(a=this,l--);l<h;l++)if(null!=(t=arguments[l]))for(i in t)s=a[i],a!==(n=t[i])&&(d&&n&&((o="[object Array]"===c.call(n))||"[object Object]"===c.call(n))?(o?(o=!1,s=s&&"[object Array]"===c.call(s)?s:[]):s=s&&"[object Object]"===c.call(s)?s:{},a[i]=e(d,s,n)):void 0!==n&&(a[i]=n));return a}function i(t){return Array.prototype.map.call(t,function(t){return t})}var s,n,o,a,r=!!navigator.userAgent.match(/mobile/i),c="ontouchend"in document,l=window.navigator.pointerEnabled,h=window.navigator.msPointerEnabled;r?c?(s="touchstart",n="touchmove",o="touchend",a="touchcancel"):l?(s="pointerdown",n="pointermove",o="pointerup"):h?(s="MSPointerDown",n="MSPointerMove",o="MSPointerUp"):(s="mousedown",n="mousemove",o="mouseup"):(s="mousedown",n="mousemove",o="mouseup");var d=function(t,e){},p={obj:null,holder:null,start:d,move:d,end:d};e(t.prototype,{constructor:t,_init:function(){return this._eventObj=this._options.obj||document.documentElement,this._callbackHolder=this._options.holder,this._startCallback=this._options.start,this._moveCallback=this._options.move,this._endCallback=this._options.end,this._touchID=-1,this._swipeDis=5,this._swipeTime=200,this._swipeH=!1,this._swipeV=!1,this._prevTime=0,this._data={rect:null,startX:0,startY:0,startLocalX:0,startLocalY:0,x:0,y:0,localX:0,localY:0,dx:0,dy:0,absDx:0,absDy:0,localDx:0,localDy:0,absLocalDx:0,absLocalDy:0,stepDx:0,stepDy:0,absStepDx:0,absStepDy:0,swipeLeft:!1,swipeRight:!1,swipeTop:!1,swipeBottom:!1,swipe:!1,startTime:0,dragTime:0,stepTime:0},this._eventObj=function(t,e){return t instanceof HTMLElement?[t]:"object"==typeof t&&t.length?i(t):t&&"string"==typeof t?("string"==typeof e&&(e=document.querySelector(e)),e instanceof HTMLElement||(e=document),i(e.querySelectorAll(t))):[]}(this._eventObj)[0],this._eventTarget=null,this._initProxy(),this._addEvent(),this},_initProxy:function(){for(var t in this)(function(t){return"function"==typeof t})(this[t])&&(this[t]=function(t,e){if("string"==typeof e){var i=t[e];e=t,t=i}if("function"==typeof t){var s=Array.prototype.slice,n=s.call(arguments,2),o=function(){return t.apply(e||this,n.concat(s.call(arguments)))};return o.guid=t.guid=t.guid||u++,o}}(this,t))},_addEvent:function(){this._eventObj.addEventListener(s,this._startDragHandler,{passive:!1})},_removeEvent:function(){this._eventObj.removeEventListener(s,this._startDragHandler),this._eventObj.removeEventListener(n,this._moveDragHandler),this._eventObj.removeEventListener(o,this._endDragHandler),a&&this._eventObj.removeEventListener(a,this._endDragHandler)},_startDragHandler:function(t){var i;switch(t.type){case"mousedown":case"pointerdown":case"MSPointerDown":i=t;break;case"touchstart":if(this._touchID>=0)return;i=t.changedTouches[0],this._touchID=i.identifier}var s=this._data,r=s.rect=this._getEventObjRect();s.startX=s.x=i.clientX,s.startY=s.y=i.clientY,s.startLocalX=s.localX=s.x-r.left,s.startLocalY=s.localY=s.y-r.top,s.dx=0,s.dy=0,s.absDx=0,s.absDy=0,s.localDx=0,s.localDy=0,s.absLocalDx=0,s.absLocalDy=0,s.stepDx=0,s.stepDy=0,s.absStepDx=0,s.absStepDy=0,s.swipeLeft=!1,s.swipeRight=!1,s.swipeTop=!1,s.swipeBottom=!1,s.swipe=!1,this._prevTime=s.startTime=s.dragTime=t.timeStamp,s.stepTime=0,this._eventTarget=t.currentTarget;try{if(this._startCallback&&!1===this._startCallback.call(this._callbackHolder||this._eventTarget,t,e({},s)))return void(this._touchID=-1)}catch(t){throw t}this._eventObj.addEventListener(n,this._moveDragHandler,{passive:!1}),this._eventObj.addEventListener(o,this._endDragHandler,{passive:!1}),a&&this._eventObj.addEventListener(a,this._endDragHandler,{passive:!1})},_moveDragHandler:function(t){var i;switch(t.type){case"mousemove":case"pointermove":case"MSPointerMove":i=t;break;case"touchmove":if((i=t.changedTouches[0]).identifier!==this._touchID)return}var s=this._data,n=s.rect=this._getEventObjRect();s.stepDx=i.clientX-s.x,s.stepDy=i.clientY-s.y,s.absStepDx=Math.abs(s.stepDx),s.absStepDy=Math.abs(s.stepDy),s.x=i.clientX,s.y=i.clientY,s.localX=s.x-n.left,s.localY=s.y-n.top,s.dx=s.x-s.startX,s.dy=s.y-s.startY,s.absDx=Math.abs(s.dx),s.absDy=Math.abs(s.dy),s.localDx=s.localX-s.startLocalX,s.localDy=s.localY-s.startLocalY,s.absLocalDx=Math.abs(s.absLocalDx),s.absLocalDy=Math.abs(s.absLocalDy);var o=t.timeStamp;s.dragTime=o-s.startTime,s.stepTime=o-this._prevTime,this._prevTime=o,this._swipeH=s.absStepDx>this._swipeDis,this._swipeV=s.absStepDy>this._swipeDis;try{this._moveCallback&&this._moveCallback.call(this._callbackHolder||this._eventTarget,t,e({},s))}catch(t){throw t}},_endDragHandler:function(t){if(t&&t.type){switch(t.type){case"touchend":case"touchcancel":if(t.changedTouches[0].identifier!==this._touchID)return}var i=this._data;i.stepTime<this._swipeTime&&(this._swipeH&&(this._swipeH=!1,i.swipe=!0,i.stepDx<0?i.swipeLeft=!0:i.stepDx>0&&(i.swipeRight=!0)),this._swipeV&&(this._swipeV=!1,i.swipe=!0,i.stepDy<0?i.swipeTop=!0:i.stepDy>0&&(i.swipeBottom=!0))),(i.absDx>15||i.absDy>15)&&t.preventDefault()}this._eventObj.removeEventListener(n,this._moveDragHandler),this._eventObj.removeEventListener(o,this._endDragHandler),a&&this._eventObj.removeEventListener(a,this._endDragHandler);try{this._endCallback&&this._endCallback.call(this._callbackHolder||this._eventTarget,t,e({},i))}catch(t){throw t}this._touchID=-1,this._eventTarget=null},_getEventObjRect:function(){if(this._eventObj.getBoundingClientRect)return this._eventObj.getBoundingClientRect();var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,e=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft;return{left:e,top:t,bottom:t+(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight),right:e+(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)}},destroy:function(){this._removeEvent();for(var t in Object.getOwnPropertyNames(this))delete this[t];this.__proto__=Object.prototype},open:function(){return this._eventObj.addEventListener(s,this._startDragHandler,{passive:!1}),this},close:function(){return this._eventObj.removeEventListener(s,this._startDragHandler),this},stop:function(){return this._endDragHandler(),this},remove:function(){return this.close(),this.stop(),this}});var u=0;return t});